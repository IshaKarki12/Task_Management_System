package filter;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;
import java.io.IOException;

@WebFilter("/view/*")
public class AuthFilter implements Filter {

	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
	        throws IOException, ServletException {

	    HttpServletRequest req = (HttpServletRequest) request;
	    HttpServletResponse res = (HttpServletResponse) response;
	    HttpSession session = req.getSession(false);

	    String loginURI = req.getContextPath() + "/view/login.jsp";
	    String registerURI = req.getContextPath() + "/view/register.jsp";

	    boolean loggedIn = (session != null && session.getAttribute("user") != null);
	    boolean loginRequest = req.getRequestURI().equals(loginURI);
	    boolean registerRequest = req.getRequestURI().equals(registerURI);

	    if (loggedIn || loginRequest || registerRequest) {
	        chain.doFilter(request, response); // allow access
	    } else {
	        res.sendRedirect(req.getContextPath() + "/view/login.jsp"); // redirect if not allowed
	    }
	}

}
